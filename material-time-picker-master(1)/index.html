<!DOCTYPE html>
<html lang="ja">
<head>

<!-- スケジューラ -->
<script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
<!-- <script src="https://code.jquery.com/jquery-2.1.4.min.js"></script> -->
<script src="./src/jquery-layoutday.js"></script>
<link rel="stylesheet" type="text/css" href="./src/jquery-layoutday.css">
<link rel="stylesheet" type="text/css" href="./style.css">
  <meta charset="utf-8">
  <title>Positarm</title>
<script>
var layOutDay = function (cal_events){
  $('#calendar').addEvents(cal_events);
};
$( document ).ready(function() {
    $('#calendar').layOutDay({
      'calendar_start': 540,
      'calendar_end': 1260,
      'time_selector': 'body .time'
    });

    // calendarEvent = {
    //                     dateStart: new Date(/* year */ 2017, /* month */ 01,  /* day */ 09, /* hour */ 18, /* minute */ 30, /* senconds */ 10, /* milliseconds */ 10),
    //                     dateEnd: new Date(/* year */ 2017, /* month */ 01, /* day */ 09, /* hour */ 19, /* minute */ 30, /* senconds */ 10, /* milliseconds */ 10),
    //                     title: "title",
    //                     description: "description"
    //                 }
    // console.log(calendarEvent);
    // layOutDay([
    //     {event: calendarEvent},
    //     {event: calendarEvent}
    // ]);
});


events_list = [];
function x() {
  console.log("begin addevent");
  let seventDatetime = document.getElementById('event_sdatetime').value;
  console.log(seventDatetime);
  seventDatetime = new Date(seventDatetime);
  let seventYear = seventDatetime.getFullYear();
  let seventMonth = seventDatetime.getMonth();
  let seventDay = seventDatetime.getDay();
  let seventHour = seventDatetime.getHours();
  let seventMinute = seventDatetime.getMinutes();
  console.log(seventYear)
  console.log(seventMonth)
  console.log(seventDay)
  console.log(seventHour)
  console.log(seventMinute)

  let eeventDatetime = document.getElementById('event_edatetime').value;
  console.log(eeventDatetime);
  eeventDatetime = new Date(eeventDatetime);
  let eeventYear = eeventDatetime.getFullYear();
  let eeventMonth = eeventDatetime.getMonth();
  let eeventDay = eeventDatetime.getDay();
  let eeventHour = eeventDatetime.getHours();
  let eeventMinute = eeventDatetime.getMinutes();
  console.log(eeventYear)
  console.log(eeventMonth)
  console.log(eeventDay)
  console.log(eeventHour)
  console.log(eeventMinute)

  let eventtext = document.getElementById('event_title').value;
  console.log(eventtext)

  let eventemo = document.getElementById('emo').value;
  console.log(eventemo)

  calendarEvent = {
                      dateStart: new Date(/* year */ seventYear, /* month */ seventMonth,  /* day */ seventDay, /* hour */ seventHour, /* minute */ seventMinute, /* senconds */ 10, /* milliseconds */ 10),
                      dateEnd: new Date(/* year */ eeventYear, /* month */ eeventMonth, /* day */ eeventDay, /* hour */ eeventHour, /* minute */ eeventMinute, /* senconds */ 10, /* milliseconds */ 10),
                      title: eventtext,
                      description: eventemo
                  }
  console.log(calendarEvent);
  layOutDay([
      {event: calendarEvent}
  ]);

  console.log("end addevent");

  var textForm = document.getElementById("event_sdatetime");
  textForm.value = '';

  var textForm = document.getElementById("event_edatetime");
  textForm.value = '';

  var textForm = document.getElementById("emo");
  textForm.value = '選択してください';

	var textForm = document.getElementById("event_title");
  textForm.value = '';

  events_list.push(calendarEvent);
}

</script>



<!-- 目覚まし -->
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Material Bootstrap CSS -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700%7CMaterial+Icons">
    <link rel="stylesheet" href="https://unpkg.com/bootstrap-material-design@4.0.0-beta.4/dist/css/bootstrap-material-design.min.css" integrity="sha384-R80DC0KVBO4GSTw+wZ5x2zn2pu4POSErBkf8/fSFhPXHxvHJydT0CSgAP2Yo2r4I" crossorigin="anonymous">

    <!-- Date Picker CSS -->
    <link rel="stylesheet" href="./timepicker.css">
</head>





<body style="margin: 0px 25px;">


 <header>
   <h1>
     <a href="">
       <img src="./logosample.png" width="155" alt="Positarm">
      </a>
   </h1>
     </a>
   </h1>
 </header>


  <div class="centering_item">
    <div id="current_time">現在時刻 --:--:--</div>
  </div>
  <div class="centering_item2">
    <p>アラーム : <strong><span id="time"></span></strong></p>
  </div>

    <!-- <div id="set_alarm_time">アラーム --:--</div> -->
    <!-- <input type="time" id="alarm_time"> -->
    <!-- <input type="button" value="アラームセット" onclick="setAlarmTime()"> -->
  <div class="centering_buttons">
    <button id="time-button" type="button" class="btn btn-raised btn-primary">アラームセット</button>
    <audio id="alarm-audio" loop></audio>
    <br>
    <a href="#" class="reset-button" onclick="reset()">アラームを止める</a>
  </div>
  <br>
  <br>

    <!-- TIME PICKER -->
    <div id="time-picker">
        <div>
            <div id="time-picker-header" class="time-picker-bg">
                <p>
                    <span id="time-picker-hour"></span>
                    <span id="time-picker-mins"></span>
                    <span id="time-picker-ampm"></span>
                </p>
            </div>
            <div>
                <a id="time-picker-alt-ok-button" class="btn btn-sm btn-flat"><i class="material-icons">check_circle</i></a>
            </div>
            <div id="time-picker-clock">
                <span id="time-picker-hour-hand"></span>
                <span id="time-picker-hour-center"></span>
                <p id="time-picker-hour-1" class="time-picker-hour" data-value="1"></p>
                <p id="time-picker-hour-2" class="time-picker-hour" data-value="2"></p>
                <p id="time-picker-hour-3" class="time-picker-hour" data-value="3"></p>
                <p id="time-picker-hour-4" class="time-picker-hour" data-value="4"></p>
                <p id="time-picker-hour-5" class="time-picker-hour" data-value="5"></p>
                <p id="time-picker-hour-6" class="time-picker-hour" data-value="6"></p>
                <p id="time-picker-hour-7" class="time-picker-hour" data-value="7"></p>
                <p id="time-picker-hour-8" class="time-picker-hour" data-value="8"></p>
                <p id="time-picker-hour-9" class="time-picker-hour" data-value="9"></p>
                <p id="time-picker-hour-10" class="time-picker-hour" data-value="10"></p>
                <p id="time-picker-hour-11" class="time-picker-hour" data-value="11"></p>
                <p id="time-picker-hour-12" class="time-picker-hour" data-value="12"></p>
            </div>
            <p id="time-picker-am-button" class="time-picker-ampm-button">AM</p>
            <p id="time-picker-pm-button" class="time-picker-ampm-button">PM</p>
            <div id="time-picker-buttons" class="text-right">
                <a id="time-picker-reset-button" class="btn btn-sm btn-flat"><i class="material-icons">today</i></a>
                <a id="time-picker-cancel-button" class="btn btn-sm btn-flat">閉じる</a>
                <a id="time-picker-ok-button" class="btn btn-sm btn-flat">OK</a>
            </div>
        </div>
    </div>
    <!-- TIME PICKER -->


    <!-- JQuery, Bootstrap JS -->
    <!-- <script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script> -->
    <script src="https://unpkg.com/popper.js@1.12.6/dist/umd/popper.js" integrity="sha384-fA23ZRQ3G/J53mElWqVJEGJzU0sTs+SvzG8fXVWP+kJQ1lwFAOkcUOysnlKJC33U" crossorigin="anonymous"></script>
    <script src="https://unpkg.com/bootstrap-material-design@4.0.0-beta.4/dist/js/bootstrap-material-design.js" integrity="sha384-3xciOSDAlaXneEmyOo0ME/2grfpqzhhTcM4cE32Ce9+8DW/04AGoTACzQpphYGYe" crossorigin="anonymous"></script>
    <script>$(document).ready(function() { $('body').bootstrapMaterialDesign(); });</script>

    <!-- TimePicker JS -->
    <script type="text/javascript" src="./timepicker.js"></script>
    <script type="text/javascript">

    // Initialize alarm sound
    // Select HTML5 Audio element
    const alarmAudio = document.getElementById("alarm-audio");

    // soundURL
    alarmAudio.src = "./My Medly (3 6, 2022).m4a";
    alarmAudio.load();


    let alarmString;
    function setAlarmTime(v){
      if(v){
        alarmString = v;
      }else{
        alarmString = document.getElementById('alarm_time').value;
      }
      document.getElementById("set_alarm_time").innerHTML = alarmString;
    }

    // sound reset
    function reset(){
      alarmAudio.pause();
      alarmAudio.currentTime = 0;
      document.getElementById("time").innerHTML = "";

      console.log(events_list);
      console.log(events_list[0]["dateStart"])
      // console.log(events_list[1]["description"].slice(1, 2))

      let eventtime0;
      eventtime0 = new Date(events_list[0]["dateStart"]);
      console.log(eventtime0)
      let event0Hour = eventtime0.getHours();
      let event0Minute = eventtime0.getMinutes();
      console.log(event0Hour)
      console.log(event0Minute)

      let eventetime0;
      eventetime0 = new Date(events_list[0]["dateEnd"]);
      console.log(eventetime0)
      let evente0Hour = eventetime0.getHours();
      let evente0Minute = eventetime0.getMinutes();
      console.log(evente0Hour)
      console.log(evente0Minute)

      let ii;
      if (events_list[0]["description"] === "ポジティブ" && events_list[1] === undefined){
        ii = "本日は" + event0Hour + "時" + event0Minute + "分から" + events_list[0]["title"] + "があります。思い切り楽しんでください！";
      }else if(events_list[0]["description"] === "ネガティブ" && events_list[1] === undefined){
        ii = "本日は" + evente0Hour + "時" + evente0Minute + "分から" + "フリータイムが待っています。それを糧に頑張りましょう！";
      }
      else {

      let eventstime1;
      eventstime1 = new Date(events_list[1]["dateStart"]);
      console.log(eventstime1)
      let events1Hour = eventstime1.getHours();
      let events1Minute = eventstime1.getMinutes();
      console.log(events1Hour)
      console.log(events1Minute)

      let eventtime1;
      eventtime1 = new Date(events_list[1]["dateEnd"]);
      console.log(eventtime1)
      let event1Hour = eventtime1.getHours();
      let event1Minute = eventtime1.getMinutes();
      console.log(event1Hour)
      console.log(event1Minute)

      let i;
      if (events_list[0]["description"] === "ポジティブ" && events_list[1]["description"] === "ポジティブ") {
        i = "本日は" + event0Hour + "時" + event0Minute + "分から" + events_list[0]["title"] + events1Hour + "時" + events1Minute + "分から" + events_list[1]["title"] + "があります。今日はいい日になりそうですね！";
      }else if (events_list[0]["description"] === "ポジティブ" && events_list[1]["description"] === "ネガティブ"){
        i = "本日は" + event1Hour + "時" + event1Minute + "分からフリータイムが待っています。リフレッシュできますね！";
      }else if (events_list[0]["description"] === "ネガティブ" && events_list[1]["description"] === "ポジティブ"){
        i = "本日は" + events1Hour + "時" + events1Minute + "分から" + events_list[1]["title"] + "があります。存分に楽しみましょう！";
      }else if (events_list[0]["description"] === "ネガティブ" && events_list[1]["description"] === "ネガティブ"){
        i = "本日は" + event1Hour + "時" + event1Minute + "分からフリータイムが待っています。そこまで頑張りましょう！";
      }
      // // 発言を作成
      const uttr = new SpeechSynthesisUtterance(i)
      // // 発言を再生 (発言キューに発言を追加)
      speechSynthesis.speak(uttr)
    }
    // // 発言を作成
    const uttr = new SpeechSynthesisUtterance(ii)
    // // 発言を再生 (発言キューに発言を追加)
    speechSynthesis.speak(uttr)
  }

    function checkAlarm(timeString){
      if (alarmString) {
          console.log("checkalarm");
          console.log(alarmString);
          console.log(timeString);
          if (alarmString === timeString) {
            console.log("playalarm");
            alarmAudio.play();
          }
      }
    }

    function getTimeString(hours, minutes, seconds){
      if (minutes / 10 < 1) {
        minutes = "0" + minutes;
      }
      if (seconds / 10 < 1) {
        seconds = "0" + seconds;
      }
      return hours + ":" + minutes + ":" + seconds;
    };

    // bigin 現在時刻
    function showClock() {
      let nowTime = new Date();
      let nowHour = nowTime.getHours();
      let nowMin  = nowTime.getMinutes();
      let nowSec  = nowTime.getSeconds();
      timeString = getTimeString(nowHour, nowMin, nowSec);
      let msg = "現在時刻 " + timeString;
      checkAlarm(timeString);
      document.getElementById("current_time").innerHTML = msg;
    }
    setInterval('showClock()',1000);
    // end 現在時刻

        // Initialize the TimePicker
        var tp = TimePicker("#0D47A1");

        // Set Button Click Listener
        $("#time-button").click(function() {
            var time = new Date();
            tp.show(time, function(selected) {
                time.setSeconds(0);
                $("#time").html(selected.toLocaleTimeString());
                console.log(selected.toLocaleTimeString());
                setAlarmTime(selected.toLocaleTimeString());
            });
        });
    </script>

 <!-- スケジューラ -->
<div class="centering-item3">
<input type="datetime-local" id="event_sdatetime"> から
<input type="datetime-local" id="event_edatetime"> まで
<input type="text" id="event_title" placeholder="タイトル">
<select id="emo">
  <option hidden>選択してください</option>
  <option>ポジティブ</option>
  <option>ネガティブ</option>
</select>
<input type="button" value="予定を入力" onclick="x()">
</div>
<div id="calendar"></div>
<div class="time">
  <ul>
      <li>9:00 <span>AM</span></li>
      <li class="halfhour">9:30</li>
      <li>10:00 <span>AM</span></li>
      <li class="halfhour">10:30</li>
      <li>11:00 <span>AM</span></li>
      <li class="halfhour">11:30</li>
      <li>12:00 <span>PM</span></li>
      <li class="halfhour">12:30</li>
      <li>1:00 <span>PM</span></li>
      <li class="halfhour">1:30</li>
      <li>2:00 <span>PM</span></li>
      <li class="halfhour">2:30</li>
      <li>3:00 <span>PM</span></li>
      <li class="halfhour">3:30</li>
      <li>4:00 <span>PM</span></li>
      <li class="halfhour">4:30</li>
      <li>5:00 <span>PM</span></li>
      <li class="halfhour">5:30</li>
      <li>6:00 <span>PM</span></li>
      <li class="halfhour">6:30</li>
      <li>7:00 <span>PM</span></li>
      <li class="halfhour">7:30</li>
      <li>8:00 <span>PM</span></li>
      <li class="halfhour">8:30</li>
      <li>9:00 <span>PM</span></li>
  </ul>
</div>

<footer class="footer">
</footer>
</body>
</html>
